!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t||self).campaignionTracking={})}(this,function(t){class e{constructor(t,e,n){void 0===e&&(e=window.dataLayer),void 0===n&&(n=!1),this.debug=n,this.dataLayer=e,this.tracker=t,this._context=this.loadFromStorage("context")||{node:{},donation:{currencyCode:null,product:null},webform:{sid:null}},this.printDebug("init"),void 0!==this.tracker?void 0!==this.dataLayer?(this._dispatch=t=>{this.printDebug("campaignion_tracking_ga4","handle_form",t),this.printDebug("campaignion_tracking_ga4","handle_event",t.name,t.data,t.context),this.dispatch(t.name,t.data,t.context)},this.webformSubscription=this.tracker.subscribe("webform",this._dispatch),this.donationSubscription=this.tracker.subscribe("donation",this._dispatch)):this.printDebug("No datalayer found. Doing nothing."):this.printDebug("No TrackerManager found. Doing nothing.")}gtag(){this.dataLayer.push(arguments)}printDebug(){this.debug&&console.debug("[campaignion_tracking]","(ga4)",...[].slice.call(arguments))}saveToStorage(t,e){void 0===t&&(t="default"),this.tracker.saveToStorage("campaignion_tracking:ga4:",t,e)}loadFromStorage(t){return void 0===t&&(t="default"),this.tracker.loadFromStorage("campaignion_tracking:ga4:",t)}removeFromStorage(t){return void 0===t&&(t="default"),this.tracker.removeFromStorage("campaignion_tracking:ga4:",t)}dispatch(t,e,n){void 0===t&&(t=""),void 0===e&&(e={}),void 0===n&&(n={}),"function"==typeof this["handle_"+t]?this["handle_"+t](t,e,n):this.printDebug("no handler for event name:",t)}callChangeHook(t,e,n){return"function"==typeof window.campaignion_tracking_change_msg&&(e=window.campaignion_tracking_change_msg("ga4",t,e,n)),e}updateContext(t){void 0===t&&(t={}),t.donation&&Object.assign(this._context.donation,t.donation),t.node&&Object.assign(this._context.node,t.node),t.webform&&Object.assign(this._context.webform,t.webform),this.saveToStorage("context",this._context)}handle_submission(t,e,n){this.printDebug("(handle)",t,e,n),this.updateContext(n);let a={event:"submission",params:{nid:e.nid||null,sid:e.sid||null,title:e.title||null}};if(a=this.callChangeHook(t,a,this._context),this.gtag("event",a.event,a.params),this.printDebug("(event)",a),e.optins.length>0){let n={event:"optin",params:{}};for(const t of e.optins)n.params[t.channel]=t.value;n=this.callChangeHook(t,n,this._context),this.gtag("event",n.event,n.params),this.printDebug("(event)",n)}}handle_draftBegin(t,e,n){this.printDebug("(handle)",t,e,n),this.updateContext(n);let a={event:"begin_form",params:{nid:n.node.nid||null,title:n.node.title||null,type:n.node.type||null,completedStep:n.webform.last_completed_step||null}};a=this.callChangeHook(t,a,this._context),this.gtag("event",a.event,a.params),this.printDebug("(event)",a)}handle_draftContinue(t,e,n){this.printDebug("(handle)",t,e,n),this.updateContext(n);let a={event:"continue_form",params:{nid:n.node.nid||null,title:n.node.title||null,completedStep:n.webform.last_completed_step||null}};a=this.callChangeHook(t,a,this._context),this.gtag("event",a.event,a.params),this.printDebug("(event)",a)}handle_setDonationProduct(t,e,n){this.printDebug("(handle)",t,e,n),this.updateContext(n),e.currencyCode&&(this._context.donation.currencyCode=e.currencyCode);const a=this._context.donation.currencyCode||null,i=this._context.donation.revenue||null,o=this._context.donation.product||{},r=e.product||{},s=e.revenue||parseFloat(r.price||0)*parseInt(r.quantity||1);let c={addData:{event:"add_to_cart",params:{currency:a,value:s,items:[{item_name:r.name,item_id:r.id,price:r.price,item_variant:r.variant,quantity:r.quantity}]}},removeData:{event:"remove_from_cart",params:{currency:a,value:i,items:[{item_name:o.name,item_id:o.id,price:o.price,item_variant:o.variant,quantity:o.quantity}]}},pushRemove:Object.prototype.hasOwnProperty.call(o,"price")};c=this.callChangeHook(t,c,this._context),c.pushRemove&&(this.gtag("event",c.removeData.event,c.removeData.params),this.printDebug("(event)",c.removeData)),this.gtag("event",c.addData.event,c.addData.params),this.printDebug("(event)",c.addData),this._context.donation.revenue=s,this._context.donation.product=r,this.saveToStorage("context",this._context)}handle_checkoutBegin(t,e,n){this.printDebug("(handle)",t,e,n),this.updateContext(n);const a=e.product||this._context.donation.product||{},i=e.currencyCode||this._context.donation.currencyCode||null;let o=e.revenue||this._context.donation.revenue||null;null===o&&(o=parseFloat(a.price||0)*parseInt(a.quantity||1));let r={event:"begin_checkout",params:{currency:i,value:o,items:[{item_name:a.name,item_id:a.id,price:a.price,item_variant:a.variant,quantity:a.quantity}]}};r=this.callChangeHook(t,r,this._context),this.gtag("event",r.event,r.params),this.printDebug("(event)",r)}handle_checkoutEnd(t,e,n){this.printDebug("(handle)",t,e,n),this.updateContext(n);const a=e.product||this._context.donation.product||{},i=e.currencyCode||this._context.donation.currencyCode||null;let o=e.revenue||this._context.donation.revenue||null;null===o&&(o=parseFloat(a.price||0)*parseInt(a.quantity||1));let r={event:"add_shipping_info",params:{currency:i,value:o,items:[{item_name:a.name,item_id:a.id,price:a.price,item_variant:a.variant,quantity:a.quantity}]}};r=this.callChangeHook(t,r,this._context),this.gtag("event",r.event,r.params),this.printDebug("(event)",r)}handle_donationSuccess(t,e,n){this.printDebug("(handle)",t,e,n),this.updateContext(n);const a=e.product||this._context.donation.product||{},i=e.currencyCode||this._context.donation.currencyCode||null,o=e.tid||Math.floor(Math.random()*2**64),r=this.loadFromStorage("sentTransactionIDs")||[];if(r.indexOf(o)>=0)return void this.printDebug("(handle)","already sent TID",t,e,n);let s=e.revenue||this._context.donation.revenue||null;null===s&&(s=parseFloat(a.price||0)*parseInt(a.quantity||1));let c={event:"purchase",params:{transaction_id:o,currency:i,value:s,items:[{item_name:a.name,item_id:a.id,price:a.price,item_variant:a.variant,quantity:a.quantity}]}};c=this.callChangeHook(t,c,this._context),this.gtag("event",c.event,c.params),this.printDebug("(event)",c),r.push(o),this.saveToStorage("sentTransactionIDs",r),this.removeFromStorage("context")}}var n={__proto__:null,name:"ga4",GA4Tracker:e};const a=!!parseInt(sessionStorage.getItem("campaignion_debug"));window.dataLayer=window.dataLayer||[];const i=window.campaignion_tracking.tracker;t.ga4Tracker=null,void 0===i?console.log("No Tracker found"):(t.ga4Tracker=new e(i,window.dataLayer,a),window.campaignion_tracking_ga4={tracker:t.ga4Tracker}),t.ga4=n});
