!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t||self).campaignionTracking={})}(this,function(t){class e{constructor(t,e,n){void 0===e&&(e=window.dataLayer),void 0===n&&(n=!1),this.debug=n,this.dataLayer=e,this.tracker=t,this._context=this.loadFromStorage("context")||{node:{},donation:{currencyCode:null,product:null},webform:{sid:null}},this.printDebug("init"),void 0!==this.tracker?void 0!==this.dataLayer?(this._dispatch=t=>{this.printDebug("campaignion_tracking_ga4","handle_form",t),this.printDebug("campaignion_tracking_ga4","handle_event",t.name,t.data,t.context),this.dispatch(t.name,t.data,t.context)},this.webformSubscription=this.tracker.subscribe("webform",this._dispatch),this.donationSubscription=this.tracker.subscribe("donation",this._dispatch)):this.printDebug("No datalayer found. Doing nothing."):this.printDebug("No TrackerManager found. Doing nothing.")}gtag(){this.dataLayer.push(arguments)}printDebug(){this.debug&&console.debug("[campaignion_tracking]","(ga4)",...[].slice.call(arguments))}saveToStorage(t,e){void 0===t&&(t="default"),this.tracker.saveToStorage("campaignion_tracking:ga4:",t,e)}loadFromStorage(t){return void 0===t&&(t="default"),this.tracker.loadFromStorage("campaignion_tracking:ga4:",t)}removeFromStorage(t){return void 0===t&&(t="default"),this.tracker.removeFromStorage("campaignion_tracking:ga4:",t)}dispatch(t,e,n){void 0===t&&(t=""),void 0===e&&(e={}),void 0===n&&(n={}),"function"==typeof this["handle_"+t]?this["handle_"+t](t,e,n):this.printDebug("no handler for event name:",t)}callChangeHook(t,e,n){return"function"==typeof window.campaignion_tracking_change_msg&&(e=window.campaignion_tracking_change_msg("ga4",t,e,n)),e}updateContext(t){void 0===t&&(t={}),t.donation&&Object.assign(this._context.donation,t.donation),t.node&&Object.assign(this._context.node,t.node),t.webform&&Object.assign(this._context.webform,t.webform),this.saveToStorage("context",this._context)}handle_submission(t,e,n){this.printDebug("(handle)",t,e,n),this.updateContext(n);let i={event:"submission",params:{nid:e.nid||null,sid:e.sid||null,title:e.title||null}};if(i=this.callChangeHook(t,i,this._context),this.gtag("event",i.event,i.params),this.printDebug("(event)",i),e.optins.length>0){let n={event:"optin",params:{}};for(const t of e.optins)n.params[t.channel]=t.value;n=this.callChangeHook(t,n,this._context),this.gtag("event",n.event,n.params),this.printDebug("(event)",n)}}handle_draftBegin(t,e,n){this.printDebug("(handle)",t,e,n),this.updateContext(n);let i={event:"begin_form",params:{nid:n.node.nid||null,title:n.node.title||null,type:n.node.type||null,completedStep:n.webform.last_completed_step||null}};i=this.callChangeHook(t,i,this._context),this.gtag("event",i.event,i.params),this.printDebug("(event)",i)}handle_draftContinue(t,e,n){this.printDebug("(handle)",t,e,n),this.updateContext(n);let i={event:"continue_form",params:{nid:n.node.nid||null,title:n.node.title||null,completedStep:n.webform.last_completed_step||null}};i=this.callChangeHook(t,i,this._context),this.gtag("event",i.event,i.params),this.printDebug("(event)",i)}handle_setDonationProduct(t,e,n){this.printDebug("(handle)",t,e,n),this.updateContext(n),e.currencyCode&&(this._context.donation.currencyCode=e.currencyCode);const i=this._context.donation.currencyCode||null,a=this._context.donation.revenue||null,o=e.prevProduct||{},r=e.product||{},s=e.revenue||parseFloat(r.price||0)*parseInt(r.quantity||1);let d={addData:{event:"add_to_cart",params:{currency:i,value:s,items:[{item_name:null==r?void 0:r.name,item_id:null==r?void 0:r.id,price:null==r?void 0:r.price,item_variant:null==r?void 0:r.variant,quantity:null==r?void 0:r.quantity}]}},removeData:{event:"remove_from_cart",params:{currency:i,value:a,items:[{item_name:null==o?void 0:o.name,item_id:null==o?void 0:o.id,price:null==o?void 0:o.price,item_variant:null==o?void 0:o.variant,quantity:null==o?void 0:o.quantity}]}},pushRemove:Object.prototype.hasOwnProperty.call(o,"price")};d=this.callChangeHook(t,d,this._context),d.pushRemove&&this.gtag("event",d.removeData.event,d.removeData.params),this.gtag("event",d.addData.event,d.addData.params),this._context.donation.revenue=s,this.saveToStorage("context",this._context)}handle_checkoutBegin(t,e,n){this.printDebug("(handle)",t,e,n),this.updateContext(n);const i=e.product||this._context.donation.product||{},a=e.currencyCode||this._context.donation.currencyCode||null;let o=e.revenue||this._context.donation.revenue||null;null===o&&(o=parseFloat(i.price||0)*parseInt(i.quantity||1));let r={event:"begin_checkout",params:{currency:a,value:o,items:[{item_name:null==i?void 0:i.name,item_id:null==i?void 0:i.id,price:null==i?void 0:i.price,item_variant:null==i?void 0:i.variant,quantity:null==i?void 0:i.quantity}]}};r=this.callChangeHook(t,r,this._context),this.gtag("event",r.event,r.params)}handle_checkoutEnd(t,e,n){this.printDebug("(handle)",t,e,n),this.updateContext(n);const i=e.product||this._context.donation.product||{},a=e.currencyCode||this._context.donation.currencyCode||null;let o=e.revenue||this._context.donation.revenue||null;null===o&&(o=parseFloat(i.price||0)*parseInt(i.quantity||1));let r={event:"add_shipping_info",params:{currency:a,value:o,items:[{item_name:null==i?void 0:i.name,item_id:null==i?void 0:i.id,price:null==i?void 0:i.price,item_variant:null==i?void 0:i.variant,quantity:null==i?void 0:i.quantity}]}};r=this.callChangeHook(t,r,this._context),this.gtag("event",r.event,r.params)}handle_donationSuccess(t,e,n){this.printDebug("(handle)",t,e,n),this.updateContext(n);const i=e.product||this._context.donation.product||{},a=e.currencyCode||this._context.donation.currencyCode||null,o=e.tid||Math.floor(Math.random()*2**64),r=this.loadFromStorage("sentTransactionIDs")||[];if(r.indexOf(o)>=0)return void this.printDebug("(handle)","already sent TID",t,e,n);let s=e.revenue||this._context.donation.revenue||null;null===s&&(s=parseFloat(i.price||0)*parseInt(i.quantity||1));let d={event:"purchase",params:{transaction_id:o,currency:a,value:s,items:[{item_name:null==i?void 0:i.name,item_id:null==i?void 0:i.id,price:null==i?void 0:i.price,item_variant:null==i?void 0:i.variant,quantity:null==i?void 0:i.quantity}]}};d=this.callChangeHook(t,d,this._context),this.gtag("event",d.event,d.params),r.push(o),this.saveToStorage("sentTransactionIDs",r),this.removeFromStorage("context")}}var n={__proto__:null,name:"ga4",GA4Tracker:e};const i=!!parseInt(sessionStorage.getItem("campaignion_debug"));window.dataLayer=window.dataLayer||[];const a=window.campaignion_tracking.tracker;t.ga4Tracker=null,void 0===a?console.log("No Tracker found"):(t.ga4Tracker=new e(a,window.dataLayer,i),window.campaignion_tracking_ga4={tracker:t.ga4Tracker}),t.ga4=n});
